<!DOCTYPE html>
<html>
<head>
<style type="text/css">
${demo.css}

#report {
	border:2px solid green;
}

</style>
</head>
<body>

<pre>

詢問欄位數量 多 普通 少

你認為下列哪一點最重要？
	<input type="radio" name="important" value="own" checked="checked"/>擁有多少錢
		對你來說，擁有一棟一千萬的房子跟擁有<input class="money" value="10000000"/>現金有相等的幸福感
		你希望在<input class="year" value="20"/>年後，房子佔自己資產比例，不能高於<input class="percentage" value="100"/>%
		你認為用如何衡量富有程度比較正確？
			<input type="radio" name="howRich" value="avg" checked="checked"/>每日平均擁有的資產總額
			<input type="radio" name="howRich" value="avg"/>掛掉時擁有的資產總額
	<input type="radio" name="important" value="spent"/>花掉多少錢
		在<input class="year" value="20"/>年後，希望至少擁有<input class="money" value="0">的資產
			<input type="radio" name="includeHouse" value="include" checked="checked"/>含房子
			<input type="radio" name="includeHouse" value="notInclude"/>不含房子
			
外在環境估計	
	物價指數漲幅:<input class="percentage" id="priceIndex" value="1.5"/>% / 年
		支出是否隨之調漲
			Yes
			No
個人資料
	現在年齡:<input class="year" id="age" value="30"/>
	預期壽命:<input class="year" id="life" value="80"/>
	工作資料(可多筆)
		薪水：<input class="money" id="salary" value="30000"/>/月
		年終：<input class="month" id="bonus"  value="1.5">月
		調薪幅度(年)：<input class="percentage" id="salaryAdjust" value="3">%/年
			考慮增加選項 退休時年薪 可用以替代調薪幅度
		預期退休年齡：<input class="year" id="retireAge" value="60"/>
		每日工時(不含通勤)：<input class="hour" id="workHourPerDay" value="9"/>小時
		週休<input class="day" id="restPerWeek" value="2"/>日 + 月休<input class="day" id="restPerMonth" value="0"/>日 + 年休<input class="day" id="restPerYear" value="10"/>日
		
	現有資金:<input class="money" id="cash" value="0"/>
	支出(不含住宿/工作通勤)：<input class="money" id="outgoing" value="20000"/>(by 日/月/年)
	閒錢投資年報酬率：<input class="percentage" id="invest" value="1.3"/>
		套用：定存年利率(%)     1.3
	最低現金額度：<input class="money" id="saveMoney" value="100000" />元
		(可投資金額/頭期款 = 現金 - 最低現金額度)
		也可考慮用百分比作設定
	是否有額外支出(多筆)
		時間/金額
	

<div id="rent">
可租房產資料
	月租：<input class="money cost" value="6000"/>
	預期月租漲幅：<input class="percentage priceChange" value="1.5" /> %/年
	通勤時間(分/日)：<input class="minite" id="transTime" value="60"/>
	通勤支出(日)：<input class="money" id="transCost" value="100"/>
</div>
	
<div id="house">
可購買房產資料
	目標房價(現值)：<input class="money cost" value="8000000" /> 元
	預期房價漲幅：<input class="percentage priceChange" value="2" /> %/年
	持屋每年額外成本(%)     0.5
	貸款年利率：<input class="percentage loanRatePerYear" value="3"/> % / 年
	通勤時間(分/日)：<input class="minite" id="transTime" value="60"/>
	通勤支出(日)：<input class="money" id="transCost" value="100"/>
	主觀價值
		願付多少月租入住
</div>



====output====
資產總額：<span id="totalProperty"/>

租屋好還是買屋好
	租屋划算還是買屋划算？
該買多少錢的房子？
買多少錢的房子 需還多久的錢？

租房時的資產變化
買房時的資產變化
	選擇A/B/C...
	告知該買多貴的房子
	告知何時該買房子
是否修正物價指數 計算實質擁有率
============================================
針對欄位要有的功能
基本輸入
更細輸入
套用數值(含說明)
============================================

</pre>
<div id="report">
</div>
<!--租屋資產變化-->
<div id="highchartContent-rent">
</div>
<!--買屋資產變化-->
<div id="highchartContent-house">
</div>
<!--租屋買屋資產比較圖-->
<div id="highchartContent-compare">
</div>
</body>

<script src="javascripts/jquery-2.1.1.min.js"></script>
<script src="javascripts/highchart/highcharts.js"></script>
<script src="javascripts/highchart/modules/exporting.js"></script>
<script type="text/javascript">
$(function(){
	var rentData = {};
	var houseData = {};
	var seriesOptionsRent = [];
	var seriesOptionsHouse = [];
	var seriesOptionsCompare = [];

	$("input").each(function(){
		var id = $(this).attr("id");
		if(id==""||id==undefined)
			$(this).css("border","2px solid violet");
	});

	$("input").css("text-align","right");
	$("input.money").attr("size","10");
	$("input.day").attr("size","3");
	$("input.month").attr("size","4");
	$("input.year").attr("size","3");
	$("input.percentage").attr("size","5");

	function report(msg){
		$("#report").append(msg+"<br/>");
	}

	function countProperty(){
		rentData = {'cash':[],'income':[],'outgoing':[]};
		houseData = {'cash':[],'income':[],'outgoing':[],'property':[]};
		$("#report").html("");
		var year,month;
		var yearIncome, yearOutgoing;
		var nowSalary, nowOutgoing, nowCash;

		var priceIndex		= 1+$("#priceIndex").val()/100;//物價指數

		//個人資料
		var age			= $("#age").val();//當前年齡
		var life		= $("#life").val();//預期壽命
		var cash		= parseInt($("#cash").val());//當前現金
		var outgoing		= parseInt($("#outgoing").val());//支出/月
		var invest		= $("#invest").val()/100;//投資報酬率
		var saveMoney		= $("#saveMoney").val();//最低現金

		//工作資料
		var retireAge		= $("#retireAge").val();//退休年齡
		var salary		= parseInt($("#salary").val());//月薪
		var bonus		= parseFloat($("#bonus").val());//年終
		var salaryAdjust	= 1+$("#salaryAdjust").val()/100;//調薪
		var workHourPerDay	= parseFloat($("#workHourPerDay").val());//每日工時
		var restPerWeek		= parseFloat($("#restPerWeek").val());//每週休假日數
		var restPerMonth	= parseFloat($("#restPerMonth").val());//每月休假日數
		var restPerYear		= parseFloat($("#restPerYear").val());//每年休假日數
		var workDayPerYear	= 365.2425*(7-restPerWeek)/7 - 12*restPerMonth - restPerYear;
		report("每年工作日數："+Math.round(workDayPerYear));

		//工作日數(by/週/月/年)
		//每日工時*(365*(7-週休日數)/7 - 休假日數) = 每年工時

		//住宿資料
		var rent		= {};//可租房產資料
		rent["cost"]		= parseInt($("#rent .cost").val());//租金

		//租屋-資產計算
		nowSalary = salary;
		nowOutgoing = outgoing;
		nowCash = cash;

		for(year=age;year<=life;year++){
			yearIncome = yearOutgoing = 0;
			
			//計算每月收支
			for(month = 1;month<=12;month++) {
				if(year<=retireAge)
					yearIncome += nowSalary;
				yearOutgoing += nowOutgoing;
				yearOutgoing += rent['cost'];
			}
			//領年終 調薪
			if(year<=retireAge) {
				yearIncome += bonus*nowSalary;
				nowSalary *= salaryAdjust;
			}
			//投資所得(定存)
			if(nowCash > saveMoney)
				yearIncome += invest*(nowCash-saveMoney);

			nowCash += yearIncome;
			nowCash -= yearOutgoing;

			//調整物價指數
			nowOutgoing *= priceIndex;
			//report(year+"歲：年收入"+Math.round(yearIncome)+"，年支出"+Math.round(yearOutgoing)+"，累計資產"+Math.round(cash));
			rentData['cash'].push(Math.round(nowCash));
			rentData['income'].push(Math.round(yearIncome));
			rentData['outgoing'].push(Math.round(yearOutgoing));
		}

		//可購房產資料
		var house	= {};//可買房產資料
		house["cost"]	= parseInt($("#house .cost").val());//總價
		var loan	= house["cost"];//貸款
		house["loanRatePerYear"]	= 1+$("#house .loanRatePerYear").val()/100;//貸款年利率

		//買屋-資產計算
		nowSalary = salary;
		nowOutgoing = outgoing;
		nowCash = cash;

		//繳頭期款
/*		if(nowCash > saveMoney) {
			if(nowCash-saveMoney >= loan) {
				loan = 0;
				nowCash -= loan;
			} else{
				loan -= (nowCash-saveMoney);
				nowCash = saveMoney;
			}
		}*/
			
		for(year=age;year<=life;year++){
			yearIncome = yearOutgoing = 0;
			
			//計算每月收支
			for(month = 1;month<=12;month++) {
				if(year<=retireAge)
					yearIncome += nowSalary;
				yearOutgoing += nowOutgoing;
				yearOutgoing += rent['cost'];
				
			}
			//領年終 調薪
			if(year<=retireAge) {
				yearIncome += bonus*nowSalary;
				nowSalary *= salaryAdjust;
			}

			//計算貸款利息
			loan *= house['loanRatePerYear'];

			//投資所得(定存)
			if(nowCash > saveMoney) {
/*				if(nowCash > saveMoney) {
					if(nowCash-saveMoney >= loan) {
						loan = 0;
						nowCash -= loan;
					} else{
						loan -= (nowCash-saveMoney);
						nowCash = saveMoney;
					}
				}*/
				yearIncome += invest*(nowCash-saveMoney);
			}

			nowCash += yearIncome;
			nowCash -= yearOutgoing;

			//調整物價指數
			nowOutgoing *= priceIndex;
			//report(year+"歲：年收入"+Math.round(yearIncome)+"，年支出"+Math.round(yearOutgoing)+"，累計資產"+Math.round(cash));
			houseData['cash'].push(Math.round(nowCash));
			houseData['income'].push(Math.round(yearIncome));
			houseData['outgoing'].push(Math.round(yearOutgoing));
		}
		drawHighchart();
	}
	countProperty();
	$("input").change(countProperty);

        $('#container').highcharts({
        });

	function drawHighchart() {
		/* HIGH STOCK */
		var	yAxisOptions		= [],
			colors			= Highcharts.getOptions().colors;

		var sec = 31536000;
		seriesOptionsRent = [{
			name: "累計現金",
			data: rentData['cash']
		},{
			name: "年收入",
			data: rentData['income']
		},{
			name: "年支出",
			data: rentData['outgoing']
		}];
		seriesOptionsHouse = [{
			name: "累計資產",
			data: houseData['cash']
		},{
			name: "累計現金",
			data: houseData['cash']
		},{
			name: "年收入",
			data: houseData['income']
		},{
			name: "年支出",
			data: houseData['outgoing']
		}];
		seriesOptionsCompare = [{
			name: "租屋資產",
			data: rentData['cash']
		},{
			name: "買屋資產",
			data: houseData['cash']
		}];
		createChart();
	}


	// create the chart when all data is loaded
	function createChart() {
		$('#highchartContent-rent').highcharts({
			title: {
				text: '租屋資產變化',
				x: -20 //center
			},
//			subtitle: {
//				text: 'Source: WorldClimate.com',
//				x: -20
//			},
//            xAxis: {
//                categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
//                    'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
//            },
			yAxis: {
				title: {
					text: '資產/現金總額(NT)'
				},
				plotLines: [{
					value: 0,
					width: 1,
					color: '#808080'
				}]
			},
			tooltip: {
				valueSuffix: 'NT'
			},
			legend: {
				layout: 'vertical',
				align: 'right',
				verticalAlign: 'middle',
				borderWidth: 0
			},
			series: seriesOptionsRent
		});
		$('#highchartContent-house').highcharts({
			title: {
				text: '買屋資產變化',
				x: -20 //center
			},
//			subtitle: {
//				text: 'Source: WorldClimate.com',
//				x: -20
//			},
//            xAxis: {
//                categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
//                    'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
//            },
			yAxis: {
				title: {
					text: '資產/現金總額(NT)'
				},
				plotLines: [{
					value: 0,
					width: 1,
					color: '#808080'
				}]
			},
			tooltip: {
				valueSuffix: 'NT'
			},
			legend: {
				layout: 'vertical',
				align: 'right',
				verticalAlign: 'middle',
				borderWidth: 0
			},
			series: seriesOptionsHouse
		});
		$('#highchartContent-compare').highcharts({
			title: {
				text: '租屋買屋資產比較圖',
				x: -20 //center
			},
//			subtitle: {
//				text: 'Source: WorldClimate.com',
//				x: -20
//			},
//            xAxis: {
//                categories: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
//                    'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
//            },
			yAxis: {
				title: {
					text: '資產/現金總額(NT)'
				},
				plotLines: [{
					value: 0,
					width: 1,
					color: '#808080'
				}]
			},
			tooltip: {
				valueSuffix: 'NT'
			},
			legend: {
				layout: 'vertical',
				align: 'right',
				verticalAlign: 'middle',
				borderWidth: 0
			},
			series: seriesOptionsCompare
		});
	}

});
</script>

</html>

